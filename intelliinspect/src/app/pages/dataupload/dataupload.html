<div class="container-fluid">

  <!-- Header Banner -->
  <div class="header-banner d-flex justify-content-between align-items-center p-3 text-white">
    <h3 class="mb-0">MiniML - Predictive Quality Control</h3>
    <img src="abb-logo.png" alt="ABB Logo" height="60">
  </div>

  <div class="main-content">

    <!-- Stepper Navigation -->
    <div class="stepper-container d-flex justify-content-between align-items-center my-3">
      <div class="step active">
        <div class="step-number">1</div>
        <div class="step-label">Upload Dataset</div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-label">Date Ranges</div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-label">Model Training</div>
      </div>
      <div class="step">
        <div class="step-number">4</div>
        <div class="step-label">Simulation</div>
      </div>
    </div>

    <!-- Upload Section -->
    <div class="card panel-card shadow-sm mb-4">
      <div class="card-header d-flex align-items-center justify-content-between">
        <h5 class="mb-0">Upload Dataset</h5>
        <span class="badge bg-primary">Step 1 of 4</span>
      </div>

      <div class="card-body">

        <!-- Drag & Drop / File chooser -->
        <div class="dropzone text-center p-4"
            [attr.aria-busy]="isUploading"
            [class.uploading]="isUploading">

          <p class="mb-1">Drag & drop a CSV here, or click to select</p>
          <input
            type="file"
            accept=".csv"
            (change)="onFileSelected($event)"
            class="form-control mt-2"
          />
          <div class="small text-muted mt-2" *ngIf="isUploading">Analyzing fileâ€¦</div>
          <div class="text-danger small mt-2" *ngIf="errorMsg">{{ errorMsg }}</div>
        </div>

        <!-- File Metadata Cards -->
        <div class="meta-strip mt-4" *ngIf="fileName">
          <div class="row g-3 align-items-stretch">

            <div class="col-12 col-sm-6 col-md-3 col-lg-2">
              <div class="info-card h-100">
                <div class="title">CSV File</div>
                <a href="#" class="fw-800 text-decoration-none">
                  <span class="var-text">{{ fileName }}</span>
                </a>
                <div class="small-muted">
                  <span class="var-text">{{ fileSize }}</span> KB
                </div>
              </div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <div class="info-card h-100">
                <div class="title">Records</div>
                <p class="value text-primary-strong">
                  <span class="var-text">{{ metadata.records || 0 }}</span>
                </p>
              </div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <div class="info-card h-100">
                <div class="title">Columns</div>
                <p class="value text-primary-strong">
                  <span class="var-text">{{ metadata.columns || 0 }}</span>
                </p>
              </div>
            </div>

            <div class="col-6 col-md-3 col-lg-2">
              <div class="info-card h-100">
                <div class="title">Pass Rate</div>
                <p class="value text-success-strong">
                  <span class="var-text">{{ metadata.passRate || 0 }}</span>%
                </p>
              </div>
            </div>

            <div class="col-12 col-lg-4">
              <div class="info-card h-100">
                <div class="title">Date Range</div>
                <h6 class="mb-0">
                  <span class="text-primary-strong fw-800">
                    <span class="var-text">{{ metadata.startDate || '-' }}</span>
                  </span>
                  <span class="text-muted"> to </span>
                  <span class="text-primary-strong fw-800">
                    <span class="var-text">{{ metadata.endDate || '-' }}</span>
                  </span>
                </h6>
                <div class="small-muted mt-1" *ngIf="metadata.hasTimestamp !== undefined">
                  {{ metadata.hasTimestamp ? 'Timestamp found in file' : 'Synthetic timestamp added (1s cadence)' }}
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Confirmation -->
        <div class="form-check mt-3" *ngIf="analysisDone">
          <input class="form-check-input" type="checkbox" id="confirmCheck" [(ngModel)]="userConfirmed">
          <label class="form-check-label small" for="confirmCheck">
            I confirm the above metadata looks correct.
          </label>
        </div>

        <!-- Next Button -->
        <div class="text-end mt-4">
          <button
            class="btn btn-primary btn-next"
            [disabled]="!(analysisDone && userConfirmed)"
            [routerLink]="['/daterange']"
          >
            Next
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <div class="header-banner bg-danger text-white text-center py-2">
    <small>Engineered to Outrun | MiniML POC</small>
  </div>
</div>
